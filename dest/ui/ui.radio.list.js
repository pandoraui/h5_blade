define(["UILayer","text!T_UILayerList","UIScroll"],function(a,b,c){return _.inherit(a,{propertys:function($super){$super(),this.template=b,this.title="标题",this.data=[],this.selectId=null,this.index=-1,this.itemNum=this.data.length,this.displayNum=5,this.checekdClass="active",this.scroll=null,this.addEvents({"click .js_items> li":"clickAction"}),this.onClick=function(a){0}},getViewModel:function(){return this._getDefaultViewModel(["title","data","selectId","index"])},resetPropery:function($super){$super(),this._resetNum(),this._resetIndex()},_resetIndex:function(){if(this.selectId)for(var a=0,b=this.data.length;b>a;a++)if(this.selectId==this.data[a].id){this.index=a;break}},_resetNum:function(){this.displayNum=this.displayNum%2==0?this.displayNum+1:this.displayNum,this.itemNum=this.data.length},clickAction:function(a){var b=$(a.currentTarget),c=b.attr("data-index");this.setIndex(c),this.onClick&&this.onClick.call(this,this.getSelected(),c,a)},setId:function(a){if(a){var b,c,d=-1;for(b=0,c=this.data.length;c>b;b++)if(this.data[b].id==a){d=b;break}-1!=d&&(this.selectId=a,this.index=d,this.setIndex(d))}},getId:function(){return this.selectId},setIndex:function(a,b){a=parseInt(a),0>a||a>=this.data.length||(this.index=a,this.selectId=this.data[a].id,this.$("li").removeClass(this.checekdClass),this.$('li[data-index="'+a+'"]').addClass(this.checekdClass),b&&this._position())},getIndex:function(){return this.index},getSelected:function(){return this.data[this.index]},initElement:function(){this.swrapper=this.$(".js_wrapper"),this.scroller=this.$(".js_items")},initSize:function(){var a=this.displayNum;this.sheight=this.scroller.height(),this.itemHeight=parseInt(this.sheight/this.itemNum),a>this.itemNum&&(a=this.itemNum),this.swrapper.height(this.itemHeight*a)},_position:function(){if(this.scroll){var a,b=this.index;0>b&&(b=0),this.itemNum-b<this.displayNum&&(b=this.itemNum-this.displayNum),a=this.itemHeight*b*-1,this.scroll.scrollTo(0,a)}},addEvent:function($super){$super(),this.on("onShow",function(){this.initSize(),this.scroll&&this.scroll.destory&&this.scroll.destory(),this.itemNum>this.displayNum&&(this.scroll=new c({wrapper:this.swrapper,scroller:this.scroller}),this._position())},1),this.on("onHide",function(){this.scroll&&(this.scroll.destroy(),this.scroll=null)})}})});