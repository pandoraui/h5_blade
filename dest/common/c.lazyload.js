define([],function(){return _.inherit({propertys:function(){this.isError=!1},initialize:function(a){this.propertys(),this.handleOpts(a),this.checkWrapperDisplay(),this.init()},checkWrapperDisplay:function(){this.isError||(this.TIMERRESCOUNT=0,this.TIMERRES&&clearInterval(this.TIMERRES),0==$(this.imgs[0]).offset().top&&(this.isError=!0,this.TIMERRES=setInterval($.proxy(function(){0,this.TIMERRESCOUNT++,($(this.imgs[0]).offset().top>0||this.TIMERRESCOUNT>1e3)&&(this.TIMERRES&&clearInterval(this.TIMERRES),0,this.isError=!1,this.refresh())},this),100)))},handleOpts:function(a){return this.isError=!1,a&&a.imgs&&a.imgs.length?(this.imgs=a.imgs,this.container=a.container||$(window),this.width=a.width,this.height=a.height,this.loadingImg=a.loadingImg||"http://pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png",this.loadingBg=a.loadingBg||"#ebebeb",this.needWrapper=!1,(this.width||this.height)&&(this.needWrapper=!0),this.wrapper=a.wrapper||'<div class="cui_lazyload_wrapper" style="text-align: center; vertical-align: middle; "></div>',void(this.imgContainer={})):void(this.isError=!0)},init:function(){this.isError||(this.initImgContainer(),this.lazyLoad(),this.bindEvents())},refresh:function(a){a&&this.handleOpts(a),this.init()},bindEvents:function(){this.isError||(this.destroy(),this.container.on("scroll.imglazyload",$.proxy(function(){this.lazyLoad()},this)),$(window).on("resize.imglazyload",$.proxy(function(){this.initImgContainer()},this)))},initImgContainer:function(){if(!this.isError){var a,b,c,d;for(b=0,c=this.imgs.length;c>b;b++)a=$(this.imgs[b]),a.attr("data-src")&&""!=a.attr("data-src")&&"1"!=a.attr("data-load")&&(d=a.offset(),this.imgContainer[d.top]||(this.imgContainer[d.top]=[]),this.imgContainer[d.top].push(a))}},_handleImg:function(a){var b,c;a.attr("data-src")&&""!=a.attr("data-src")&&(this.needWrapper&&(c=$(this.wrapper),c.css({width:this.width+"px",height:this.height+"px","background-color":this.loadingBg}),c.insertBefore(a),c.append(a)),b=$(new Image),a.attr("src")||a.attr("src",this.loadingImg),b.on("error",function(){a.attr("src",this.loadingImg)}).on("load",function(){a.attr("src",a.attr("data-src")),a.attr("data-load","1"),setTimeout(function(){c&&c[0]&&(a.insertBefore(c),c.remove())},1)}).attr("src",a.attr("data-src")))},lazyLoad:function(){if(!this.isError){var a,b,c,d,e,f=this.container.height(),g=this.container.scrollTop();for(a in this.imgContainer)if(parseInt(a)<g+f){for(b=this.imgContainer[a],d=0,e=b.length;e>d;d++)c=$(b[d]),this._handleImg(c);delete this.imgContainer[a]}}},destroy:function(){this.isError||(this.container.off(".imglazyload"),$(window).off(".imglazyload"))}})});