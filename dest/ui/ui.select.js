define(["UIView","text!T_UISelect","text!C_UISelect","UIScroll"],function(a,b,c,d){return _.inherit(a,{propertys:function($super){$super(),this.template=b,this.addUIStyle(c),this.curClass="active",this.data=[],this.key=null,this.index=0,this.animatTime=100,this.stepTime=150,this.itemNum=this.data.length,this.displayNum=5,this.scrollOffset=0,this.scroll=null,this.changed=function(a){0}},getViewModel:function(){return this._getDefaultViewModel(["curClass","data","key","index"])},resetPropery:function(){this._resetNum(),this._resetIndex()},_resetIndex:function(){if(this.key)for(var a=0,b=this.data.length;b>a;a++)if(this.key===this.data[a].id){this.index=a;break}},_resetNum:function(){this.displayNum=this.displayNum%2==0?this.displayNum+1:this.displayNum,this.itemNum=this.data.length},initElement:function(){this.swrapper=this.$(".js_wrapper"),this.scroller=this.$(".js_scroller")},initSize:function(){this.itemHeight=parseInt(window.getComputedStyle&&getComputedStyle(this.scroller.find("li").eq(0)[0]).height),this.scroller.height(this.itemHeight*this.itemNum),this.swrapper.height(this.itemHeight*this.displayNum),this.scrollOffset=(this.displayNum-1)/2*this.itemHeight},adjustPosition:function(a){if(this.scroll){this.index<0&&(this.index=0),this.index>this.itemNum-1&&(this.index=this.itemNum-1);var b,c=this.index,d=0;b=this.itemHeight*c*-1+this.scrollOffset,a&&(d=this.animatTime),this.scroll.scrollTo(0,b,d)}},_initScroll:function(){return this.scroll?void this.scroll.refresh():(this.scroll=new d({scrollbars:!1,scrollOffset:this.scrollOffset,step:this.itemHeight,wrapper:this.swrapper,bounceTime:200,scroller:this.scroller}),this.scroll.on("scrollEnd",$.proxy(function(){this.setIndex(this.getIndexByPosition(),!0)},this)),void this.scroll.on("scrollCancel",$.proxy(function(){this.setIndex(this.getIndexByPosition(),!1)},this)))},reload:function(a){a&&this.setOpts(a),this.scroll&&(this.scroll.destroy(),this.scroll=null),this._dataChanged=!0,this.refresh()},checkDisable:function(a){a=a||"down";var b=this.index;this.data[b]&&"undefined"!=typeof this.data[b].disabled&&0==this.data[b].disabled&&("up"==a?(this.index=this._checkSelectedDown(b),"number"!=typeof this.index&&(this.index=this._checkSelectedUp(b))):(this.index=this._checkSelectedUp(b),"number"!=typeof this.index&&(this.index=this._checkSelectedDown(b)))),"number"!=typeof this.index&&(this.index=b)},_checkSelectedUp:function(a){for(var b=!1,c=a;-1!=c;c--)if(this.data[c]&&("undefined"==typeof this.data[c].disabled||1==this.data[c].disabled)){a=c,b=!0;break}return b?a:null},_checkSelectedDown:function(a){for(var b=!1,c=a,d=this.data.length;d>c;c++)if(this.data[c]&&("undefined"==typeof this.data[c].disabled||1==this.data[c].disabled)){a=c,b=!0;break}return b?a:null},setIndex:function(a,b,c){"undefined"==typeof b&&a==this.index&&(b=!0);var d,e=a,f=this.index!=a,g=a>this.index?"up":"down";a=parseInt(a),0>a||a>=this.itemNum||(d=this.index,this.index=a,this.checkDisable(g),f=d!=this.index?!0:!1,e!=this.index&&(b=!1),b||this.adjustPosition(!0),this.resetCss(),this._dataChanged?(this.triggerChangedAction(),this._dataChanged=!1):c!==!0&&f&&this.triggerChangedAction())},triggerChangedAction:function(){this.changed&&this.changed.call(this,this.getSelected())},resetCss:function(){this.$("li").removeClass("active"),this.$('li[data-index="'+this.index+'"]').addClass("active")},resetIndex:function(){this.setIndex(this.index,!0,!0)},getIndex:function(){return this.index},setId:function(a){if(a){var b,c,d=-1;for(b=0,c=this.data.length;c>b;b++)if(this.data[b].id==a){d=b;break}-1!=d&&(this.index=d,this.setIndex(d,!1))}},getId:function(){return this.getSelected().id},getSelected:function(){return this.data[this.index]},getIndexByPosition:function(){var a=this.scroll.y-this.scrollOffset,b=Math.abs(a)/this.itemHeight;return Math.round(b)},addEvent:function($super){$super(),this.on("onShow",function(){this.initSize(),this._initScroll(),this.adjustPosition(),this.resetCss(),this.resetIndex()},1),this.on("onHide",function(){this.scroll&&(this.scroll.destroy(),this.scroll=null)})}})});