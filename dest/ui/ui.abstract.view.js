define(["text!C_UIView"],function(a){"use strict";var b=function(){var a=3e3;return function(b){return b+ ++a}}();return _.inherit({propertys:function(){this.wrapper=$("body"),this.id=_.uniqueId("ui-view-"),this.uiStyle=null,a&&(this.uiStyle=[a]),this.formateStyle="",this.shadowStyle=null,this.shadowRoot=null,this.openShadowDom=!0,this.needEmptyWrapper=!1,this.template="",this.events={},this.eventArr={},this.status="init",this.uiType=["abstractView"],this.needAnimat=!1,this.animateShowAction=null,this.animateHideAction=null},setUIType:function(a){_.isString(a)&&this.uiType.push(a)},getViewModel:function(){return _.isObject(this.datamodel)?this.datamodel:{}},_getDefaultViewModel:function(a){var b,c,d,e={};for(c=0,d=a.length;d>c;c++)b=a[c],e[b]=this[b];return e},addEvents:function(a){_.isObject(a)&&_.extend(this.events,a)},addUIStyle:function(a){this.uiStyle.push(a)},_preventDefault:function(a){a.preventDefault()},on:function(a,b,c){this.eventArr[a]||(this.eventArr[a]=[]),c?this.eventArr[a].splice(0,0,b):this.eventArr[a].push(b)},off:function(a,b){this.eventArr[a]&&(this.eventArr[a]=b?_.without(this.eventArr[a],b):[])},trigger:function(a){var b,c,d=Array.prototype.slice,e=d.call(arguments,1),f=this.eventArr,g=[];if(f[a])for(b=0,c=f[a].length;c>b;b++)g[g.length]=f[a][b].apply(this,e);return g},createRoot:function(a){this.$root=$('<div class="view" style="display: none; " id="'+this.id+'"></div>'),this.formateStyle=this.getInlineStyle(),this.shadowStyle=$(this.formateStyle),this.$el=$('<div class="js_shadow_root">'+a+"</div>"),this.openShadowDom?(this.shadowRoot=$(this.$root[0].createShadowRoot()),this.shadowRoot.append(this.shadowStyle),this.shadowRoot.append(this.$el)):(this.$root.append(this.shadowStyle),this.$root.append(this.$el))},getInlineStyle:function(){if(!this.uiStyle||!_.isArray(this.uiStyle))return"";var a=this.uiStyle.join(""),b=this.id;return this.openShadowDom||(a=a.replace(/(\s*)([^\{\}]+)\{/g,function(a,c,d){return c+d.replace(/([^,]+)/g,"#"+b+" $1")+"{"})),'<style class="js_shadow_style">'+a+"</style>"},_isAddEvent:function(a){return"onCreate"==a||"onPreShow"==a||"onShow"==a||"onRefresh"==a||"onHide"==a?!0:!1},setOption:function(a){for(var b in a)"events"!=b?this._isAddEvent(b)?this.on(b,a[b]):this[b]=a[b]:_.extend(this[b],a[b])},initialize:function(a){this.propertys(),this.setOption(a),this.resetPropery(),this.addEvent(),this.create(),this.initElement()},addSysEvents:function(){"function"==typeof this.availableFn&&(this.removeSysEvents(),this.$el.on("click.system"+this.id,$.proxy(function(a){this.availableFn()||(a.preventDefault(),a.stopImmediatePropagation&&a.stopImmediatePropagation())},this)))},removeSysEvents:function(){this.$el.off(".system"+this.id)},$:function(a){return this.$el.find(a)},resetPropery:function(){this.uiStyle||(this.openShadowDom=!1),this.wrapper[0].createShadowRoot||(this.openShadowDom=!1)},addEvent:function(){},create:function(){this.trigger("onPreCreate"),this.createRoot(this.render()),this.status="create",this.trigger("onCreate")},initElement:function(){},render:function(a){var b=this.getViewModel()||{},c=this.template;return this.template?(c=_.isFunction(this.template)?this.template(b):_.template(this.template)(b),"function"==typeof a&&a.call(this),c):""},refresh:function(a){this.resetPropery(),a?this.create():this.$el.html(this.render()),this.initElement(),"hide"!=this.status&&this.show(),this.trigger("onRefresh")},show:function(){this.wrapper[0]&&this.$root[0]&&($.contains(this.wrapper[0],this.$root[0])||(this.needEmptyWrapper&&this.wrapper.html(""),this.wrapper.append(this.$root)),this.trigger("onPreShow"),this.needAnimat&&_.isFunction(this.animateShowAction)&&"show"!=this.status?this.animateShowAction.call(this,this.$root):this.$root.show(),this.status="show",this.addSysEvents(),this.bindEvents(),this.trigger("onShow"))},hide:function(){this.$root&&"show"===this.status&&(this.trigger("onPreHide"),this.needAnimat&&_.isFunction(this.animateHideAction)&&"hide"!=this.status?this.animateHideAction.call(this,this.$root):this.$root.hide(),this.status="hide",this.unBindEvents(),this.removeSysEvents(),this.trigger("onHide"))},hasAnimationProperty:function(a){var b=[$.fx.cssPrefix+"animation-name"],c=$("<div></div>");return c.attr("class",a),$("body").append(c),"none"!=c.css(b[0])?(c.remove(),!0):(c.remove(),!1)},destroy:function(){this.status="destroy",this.unBindEvents(),this.removeSysEvents(),this.$root.remove(),this.trigger("onDestroy"),delete this},setzIndexTop:function(a,c){a||(a=this.$root),(!c||c>10)&&(c=0),c=1e3*c,a.css("z-index",b(c))},bindEvents:function(){var a=this.events;if(!a&&!(a=_.result(this,"events")))return this;this.unBindEvents();var b,c,d,e,f,g=/^(\S+)\s*(.*)$/;for(b in a)c=a[b],_.isFunction(c)||(c=this[a[b]]),c&&(d=b.match(g),e=d[1],f=d[2],c=_.bind(c,this),e+=".delegateUIEvents"+this.id,""===f?this.$el.on(e,c):this.$el.on(e,f,c));return this},unBindEvents:function(){return this.$el.off(".delegateUIEvents"+this.id),this}})});