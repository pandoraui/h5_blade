define(["UILayer","text!T_UIBubbleLayer","text!C_UIBubbleLayer"],function(a,b,c){"use strict";return _.inherit(a,{propertys:function($super){$super(),this.template=b,this.uiStyle[1]=c,this.setUIType("bubbleLayer"),this.needMask=!0,this.needReposition=!0,this.animateInClass="cm-up-in",this.animateOutClass="cm-up-out",this.scope=this,this.data=[],this.upClass="cm-pop--triangle-up",this.downClass="cm-pop--triangle-down",this.wrapperClass="cm-pop--border",this.curClass="active",this.itemStyleClass="",this.needBorder=!0,this.index=-1,this.dir="up",this.addEvents({"click .cm-pop-list>li":"clickAction"}),this.onClick=function(a,b){0,this.setIndex(b)},this.width=null,this.triangleLeft=null,this.triangleRight=null,this.triggerEl=null,this.needAnimat=!0},getViewModel:function(){return this._getDefaultViewModel(["scope","data","upClass","downClass","wrapperClass","curClass","itemStyleClass","needBorder","index","dir"])},clickAction:function(a){var b=$(a.currentTarget),c=b.attr("data-index"),d=this.data[c];this.onClick.call(this,d,c,b,a)},initElement:function(){this.el=this.$root,this.triangleEl=this.$(".icon-pop-triangle"),this.windowWidth=$(window).width()},setIndex:function(a){var b=this.curClass;a=parseInt(a),0>a||a>this.data.length||a==this.index||(this.index=a,this.$(".cm-pop-list li").removeClass(b),this.$('li[data-index="'+a+'"]').addClass(b))},reposition:function(){if(this.triggerEl){this.width&&this.el.css("width",this.width);var a=this.triggerEl.offset();this.triggerEl.offset||(this.triggerEl.offset=a),0===a.width&&this.triggerEl.offset&&(a=this.triggerEl.offset);var b=6,c=a.width-b,d=0,e=0;d="up"==this.dir?a.top+a.height+8+"px":a.top-this.el.offset().height-8+"px",e=a.left+2+"px",this.el.css(a.left+(parseInt(this.width)||c)>this.windowWidth?{position:"absolute",width:this.width||c,top:d,right:"2px"}:{position:"absolute",width:this.width||c,top:d,left:e}),this.triangleLeft&&this.triangleEl.css({left:this.triangleLeft,right:"auto"}),this.triangleRight&&this.triangleEl.css({right:this.triangleRight,left:"auto"})}},addEvent:function($super){$super(),this.on("onCreate",function(){this.mask.$el.addClass("cm-overlay--transparent"),this.mask.$el.removeClass("cui-mask")}),this.on("onShow",function(){this.setzIndexTop(this.el)})}})});