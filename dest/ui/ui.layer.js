define(["UIView","UIMask","text!C_UILayer"],function(a,b,c){"use strict";return _.inherit(a,{propertys:function($super){$super(),this.mask=new b,this.setUIType("layer"),this.resetDefaultProperty()},resetDefaultProperty:function(){this.addUIStyle(c),this.mask.resetDefaultProperty(),this.needMask=!0,this.needAnimat=!0,this.maskToHide=!0,this.needReposition=!0,this.historyBack=!1,this.animateInClass="cm-up-in",this.animateOutClass="cm-up-out",this.animateShowAction=null,this.animateHideAction=null,this.addEvents({touchmove:"_preventDefault"})},resetPropery:function($super){$super(),this._setAnimat(),this._setMaskEvent()},_setAnimat:function(){var a=this;this.needAnimat&&(this.animateShowAction||(this.animateShowAction=function(b){a._safeAnimat(b,a.animateInClass,"show")}),this.animateHideAction||(this.animateHideAction=function(b){a._safeAnimat(b,a.animateOutClass,"hide")})),this.animateHideAction?(this.mask.needAnimat=!0,this.mask.animateHideAction=function(b){a._safeAnimat(b,a.mask.animateOutClass,"hide")}):this.mask.animateHideAction=null},_safeAnimat:function(a,b,c){var d=!1;"show"==c&&a.show(),a.addClass(b),a.one($.fx.animationEnd,function(){d=!0,a.removeClass(b),"hide"==c&&a.hide()}),setTimeout(function(){d||(a.removeClass(b),a.off($.fx.animationEnd),"hide"==c&&a.hide())},350)},_setMaskEvent:function(){var a=this;this.needMask&&this.maskToHide&&this.mask.addEvents({click:function(){a.hide()}})},addEvent:function(){this.on("onCreate",function(){this.$el.addClass("cui-layer")}),this.on("onPreShow",function(){this.needMask&&this.mask.show()}),this.on("onShow",function(){this.setzIndexTop(),this.needReposition&&this.reposition()}),this.on("onHide",function(){this.mask.hide()}),this.on("onDestroy",function(){this.mask.destroy()})},reposition:function(){this.$root.css({width:"280px"}),this.$root.css({position:"fixed",left:"50%",top:"50%","margin-left":-(this.$root.width()/2)+"px","margin-top":-(this.$root.height()/2)+"px"})}})});